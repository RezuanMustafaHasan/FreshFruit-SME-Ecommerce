<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        .image-preview-container {
            margin-top: 15px;
            max-height: 200px;
            overflow: hidden;
            border-radius: 8px;
            border: 2px dashed #ddd;
            display: none;
        }
        .image-preview-container img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .preview-image img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
        }
        .upload-placeholder {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-placeholder:hover {
            background-color: #f8f9fa;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <%- include('includes/sidebar.ejs') %>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navigation -->
        <%- include('includes/navbar.ejs') %>

        <!-- Add Product Content -->
        <div class="content-area">
            <div class="add-product-container">
                <!-- Header Section -->
                <div class="add-product-header">
                    <h2><i class="fas fa-plus-circle"></i>Create New Product</h2>
                    <a href="/admin/products" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                        Back to Products
                    </a>
                </div>

                <!-- Form Card -->
                <div class="add-product-card">
                    <form action="/admin" method="POST" class="product-form needs-validation" required novalidate enctype="multipart/form-data">
                        <div class="form-row">
                            <!-- Left Column - Product Details -->
                            <div class="form-col-left">
                                <div class="form-section">
                                    <h3 class="section-title">
                                        <i class="fas fa-info-circle"></i>
                                        Product Information
                                    </h3>
                                    
                                    <div class="form-group">
                                        <label for="name" class="form-label">
                                            <i class="fas fa-tag"></i>
                                            Product Name
                                        </label>
                                        <input type="text" id="name" class="form-control" placeholder="Enter a catchy product name" name="product[name]" required>
                                        <div class="form-feedback">
                                            <div class="valid-feedback"><i class="fas fa-check-circle"></i> Perfect!</div>
                                            <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please enter a product name</div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="category" class="form-label">
                                            <i class="fas fa-folder"></i>
                                            Category
                                        </label>
                                        <input type="text" id="category" class="form-control" placeholder="e.g., Fruits, Vegetables, Organic" name="product[category]" required>
                                        <div class="form-feedback">
                                            <div class="valid-feedback"><i class="fas fa-check-circle"></i> Great choice!</div>
                                            <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please select a category</div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="description" class="form-label">
                                            <i class="fas fa-align-left"></i>
                                            Description
                                        </label>
                                        <textarea id="description" class="form-control" name="product[description]" placeholder="Describe your product in detail..." rows="4" required></textarea>
                                        <div class="form-feedback">
                                            <div class="valid-feedback"><i class="fas fa-check-circle"></i> Excellent description!</div>
                                            <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please provide a description</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3 class="section-title">
                                        <i class="fas fa-dollar-sign"></i>
                                        Pricing & Inventory
                                    </h3>
                                    
                                    <div class="form-group-row">
                                        <div class="form-group">
                                            <label for="price" class="form-label">
                                                <i class="fas fa-money-bill-wave"></i>
                                                Price
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input id="price" class="form-control" placeholder="0.00" name="product[price]" type="number" step="0.01" required>
                                            </div>
                                            <div class="form-feedback">
                                                <div class="valid-feedback"><i class="fas fa-check-circle"></i> Price set!</div>
                                                <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please enter a price</div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="unit" class="form-label">
                                                <i class="fas fa-weight"></i>
                                                Unit
                                            </label>
                                            <input type="text" id="unit" class="form-control" placeholder="kg, lb, piece, etc." name="product[unit]" required>
                                            <div class="form-feedback">
                                                <div class="valid-feedback"><i class="fas fa-check-circle"></i> Unit defined!</div>
                                                <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please specify a unit</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="stock" class="form-label">
                                            <i class="fas fa-boxes"></i>
                                            Stock Quantity
                                        </label>
                                        <input type="number" id="stock" class="form-control" placeholder="100" name="product[stock]" min="0" required>
                                        <div class="form-feedback">
                                            <div class="valid-feedback"><i class="fas fa-check-circle"></i> Stock quantity set!</div>
                                            <div class="invalid-feedback"><i class="fas fa-exclamation-circle"></i> Please enter stock quantity</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column - Image Upload -->
                            <div class="form-col-right">
                                <div class="form-section">
                                    <h3 class="section-title">
                                        <i class="fas fa-images"></i>
                                        Product Images
                                    </h3>
                                    
                                    <div class="image-upload-area">
                                        <div class="upload-placeholder" onclick="document.getElementById('imageInput').click()">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Click to upload product images</p>
                                            <small>Supports: JPG, PNG, WebP (Max: 5MB)</small>
                                        </div>
                                        <input type="file" id="imageInput" class="form-control d-none" name="product[image]" accept="image/*">
                                        
                                        <!-- Image Preview Container -->
                                        <div class="image-preview-container" id="imagePreviewContainer">
                                            <img id="uploadedImagePreview" src="" alt="Preview">
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Preview Card -->
                                <div class="product-preview-card">
                                    <h4 class="preview-title">
                                        <i class="fas fa-eye"></i>
                                        Live Preview
                                    </h4>
                                    <div class="preview-content">
                                        <div class="preview-image" id="previewImageContainer">
                                            <i class="fas fa-image"></i>
                                            <span>No image selected</span>
                                        </div>
                                        <div class="preview-details">
                                            <h5 class="preview-name" id="previewName">Product Name</h5>
                                            <p class="preview-category" id="previewCategory">Category</p>
                                            <div class="preview-price" id="previewPrice">$0.00</div>
                                            <div class="preview-stock" id="previewStock">Stock: 0 units</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle"></i>
                                Create Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Image upload preview functionality
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    
                    // Show uploaded image preview
                    const previewContainer = document.getElementById('imagePreviewContainer');
                    const previewImage = document.getElementById('uploadedImagePreview');
                    previewImage.src = imageUrl;
                    previewContainer.style.display = 'block';
                    
                    // Update live preview
                    const livePreviewContainer = document.getElementById('previewImageContainer');
                    livePreviewContainer.innerHTML = `<img src="${imageUrl}" alt="Preview" class="img-fluid">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Live preview functionality for form fields
        document.getElementById('name').addEventListener('input', function(e) {
            document.getElementById('previewName').textContent = e.target.value || 'Product Name';
        });

        document.getElementById('category').addEventListener('input', function(e) {
            document.getElementById('previewCategory').textContent = e.target.value || 'Category';
        });

        document.getElementById('price').addEventListener('input', function(e) {
            const price = e.target.value || '0.00';
            document.getElementById('previewPrice').textContent = `$${price}`;
        });

        document.getElementById('stock').addEventListener('input', function(e) {
            const stock = e.target.value || '0';
            document.getElementById('previewStock').textContent = `Stock: ${stock} units`;
        });

        // Reset preview function
        function resetPreview() {
            // Reset image previews
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('previewImageContainer').innerHTML = `
                <i class="fas fa-image"></i>
                <span>No image selected</span>
            `;
            
            // Reset text previews
            document.getElementById('previewName').textContent = 'Product Name';
            document.getElementById('previewCategory').textContent = 'Category';
            document.getElementById('previewPrice').textContent = '$0.00';
            document.getElementById('previewStock').textContent = 'Stock: 0 units';
        }

        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</body>
</html>